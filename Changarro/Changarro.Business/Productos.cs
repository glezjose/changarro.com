///////////////////////////////////////////////////////////
//  Productos.CHANGARROEntitiescs
//  Implementation of the Class Productos
//  Generated by Enterprise Architect
//  Created on:      14-nov.-2019 05:22:17 p. m.
//  Original author: jose.gonzalez
///////////////////////////////////////////////////////////

using System.Collections.Generic;
using Changarro.Model;
using Changarro.Model.DTO;
using System.Linq;
using System.Data.Entity;
using System;

namespace ChangarroBusiness
{

    public class Productos
    {
        CHANGARROEntities db = new CHANGARROEntities();
        public Productos(CHANGARROEntities _ctx)
        {
            this.db = _ctx;
            this.db.Configuration.LazyLoadingEnabled = false;
            this.db.Configuration.ProxyCreationEnabled = false;
        }

        ~Productos()
        {

        }

        public ProductosDTO AgregarProducto(tblCat_Producto _objProducto)
        {
            DbContextTransaction dbTran = db.Database.BeginTransaction();//investigar 
            try
            {
                db.tblCat_Producto.Add(_objProducto);

                db.SaveChanges();
                dbTran.Commit();
            }
            catch (Exception)
            {
                dbTran.Rollback();
                throw;
            }


            return null;
        }

        /// 
        /// <param name="iIdProducto"></param>
        public void DesactivarProducto(int iIdProducto)
        {

        }

        /// 
        /// <param name="iIdProducto"></param>
        public ProductosDTO EditarProducto(int iIdProducto)
        {

            return null;
        }

        public List<ProductosDTO> ObtenerProductos()
        {

            return null;
        }

        public List<ProductosDTO> ObtenerTopProductos()
        {

            return null;
        }
        /// <summary>
        /// Trae los datos de la tabla de productos
        /// </summary>
        /// <returns></returns>
        public List<ListaProductosDTO> ObtenerListaProductos()
        {
            List<ListaProductosDTO> lstProducto = (from producto in db.tblCat_Producto
                                                   join cat in db.tblCat_Categoria
                                                   on producto.iIdCategoria equals cat.iIdCategoria
                                                   select new ListaProductosDTO
                                                   {
                                                       iIdProducto = producto.iIdProducto,
                                                       cNombre = producto.cNombre,
                                                       NombreCate = cat.cNombre,
                                                       iCantidad = producto.iCantidad,
                                                       dtFechaAlta = producto.dtFechaAlta,
                                                       dtFechaModificacion = producto.dtFechaModificacion

                                                   }).ToList();

            return lstProducto;
        }
        /// <summary>
        /// Obtiene los datos de un producto de acuerdo a si ID
        /// </summary>
        /// <param name="_iIdProducto"></param>
        /// <returns></returns>
        public tblCat_Producto ObtenerProducto(int _iIdProducto)
        {
            tblCat_Producto oProducto = db.tblCat_Producto.Where(p => p.iIdProducto == _iIdProducto).FirstOrDefault();
            return oProducto;
        }
    }//end Productos

}//end namespace ChangarroBusiness